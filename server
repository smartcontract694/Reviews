from flask import Flask, request, jsonify, send_from_directory, render_template
from orchestratorLangchain import orchestrator  # Your existing code
from flask_cors import CORS

app = Flask(__name__)
CORS(app)

# Serve chat.html from templates folder
@app.route("/", methods=["GET"])
def index():
    return render_template("chat.html")

@app.route("/chat", methods=["POST"])
def chat():
    import time
    t0 = time.perf_counter()

    user_input = request.json.get("prompt", "")
    result = orchestrator(user_input)

    elapsed = (time.perf_counter() - t0) * 1000  # ms
    print(f"⏱️ Total time till result received by server: {elapsed:.2f} ms")

    return jsonify({"response": result})

# Serve chart images
@app.route("/static/<path:filename>")
def serve_static_file(filename):
    return send_from_directory("static", filename)


if __name__ == "__main__":
    app.run(debug=True)
